{% extends "layout.html" %} {% load static %} {% block css %}                                                                                         
<link                                                                                                                                                 
  rel="stylesheet"                                                                                                                                  
  href="{% static "plugins/bootstrap-datepicker-1.9.0/css/bootstrap-datepicker.min.css" %}"                                                         
/>                                                                                                                                                    
{% endblock %} {% block content %}                                                                                                                    
<!--如果想顶格显示可以改为container-fluid -->                                                                                                                    
<div class="container">                                                                                                                             
  <!--下面可以继续写内容了. -->                                                                                                                                 
  <!--下面可以继续写内容了. -->                                                                                                                                 
  <div class="" id="">                                                                                                                            
    <div class="container" id="">                                                                                                                 
      <div class="panel panel-default">                                                                                                             
        <div class="panel-heading">折线图</div>                                                                                                        
        <div class="panel-body">                                                                                                                    
          <div id="m1" style="width: 800px; height: 400px"></div>                                                                                 
        </div>                                                                                                                                        
      </div>                                                                                                                                          
      <div class="row" id="">                                                                                                                     
        <div class="col-sm-8" id="">                                                                                                              
          <div class="panel panel-default">                                                                                                         
            <div class="panel-heading">柱状图</div>                                                                                                    
            <div class="panel-body">                                                                                                                
              <div id="m2" style="width: 100%; height: 400px"></div>                                                                              
            </div>                                                                                                                                    
          </div>                                                                                                                                      
        </div>                                                                                                                                        
        <div class="col-sm-4" id="">                                                                                                              
          <div class="panel panel-default">                                                                                                         
            <div class="panel-heading">饼图</div>                                                                                                     
            <div class="panel-body">                                                                                                                
              <div id="m3" style="width: 400px; height: 250px"></div>                                                                             
            </div>                                                                                                                                    
          </div>                                                                                                                                      
        </div>                                                                                                                                        
      </div>                                                                                                                                          
    </div>                                                                                                                                            
  </div>                                                                                                                                              
  {% endblock %} {% block js %}                                                                                                                       
  <script src="{% static "plugins/bootstrap-datepicker-1.9.0/js/bootstrap-datepicker.min.js" %}"></script>                                          
  <script src="{% static "plugins/bootstrap-datepicker-1.9.0/locales/bootstrap-datepicker.zh-CN.min.js" %}"></script>                               
  <script src="{% static "js/echarts.min.js" %}"></script>                                                                                          
  <script type="text/javascript">                                                                                                                   
    $(function () {                                                                                                                                   
      initBar();                                                                                                                                      
    });                                                                                                                                               
                                                                                                                                                      
    //初始化柱状图                                                                                                                                          
    function initBar() {                                                                                                                              
      // 基于准备好的dom，初始化echarts实例                                                                                                                       
      var myChart = echarts.init(document.getElementById("m2"));                                                                                    
                                                                                                                                                      
      // 指定图表的配置项和数据                                                                                                                                  
      var option = {                                                                                                                                  
        title: {                                                                                                                                      
          text: "员工业绩阅读汇总信息",                                                                                                                       
          subtext: "发布",                                                                                                                            
          left: "center", //下面的实现标题居中                                                                                                               
          top: "top",                                                                                                                               
          textStyle: {                                                                                                                                
            fontSize: 20,                                                                                                                             
          },                                                                                                                                          
          subtextStyle: {                                                                                                                             
            fontSize: 10,                                                                                                                             
          },                                                                                                                                          
        },                                                                                                                                            
                                                                                                                                                      
        tooltip: {},                                                                                                                                  
        legend: {                                                                                                                                     
          data: [], //后台获取                                                                                                                            
          bottom: 0, //上面2个就在图的下面显示了                                                                                                                  
        },                                                                                                                                            
        xAxis: {                                                                                                                                      
          data: [], //后台获取                                                                                                                            
        },                                                                                                                                            
        yAxis: {},                                                                                                                                    
        series: [], //后台获取                                                                                                                            
      };                                                                                                                                              
                                                                                                                                                      
      $.ajax({                                                                                                                                        
        url: "/chart/bar/",                                                                                                                         
        type: "GET", //大括号内的是字典, 使用:                                                                                                                
        //本次要获取数据                                                                                                                                     
        dataType: "JSON",                                                                                                                           
        success: function (res) {                                                                                                                     
          if (res.status) {                                                                                                                           
            //将后台返回的数据, 写入到option                                                                                                                     
            if (res.status) {                                                                                                                         
              option.legend.data = res.data.legend;                                                                                                   
              option.xAxis.data = res.data.xAxis;                                                                                                     
              option.series = res.data.series;                                                                                                        
                                                                                                                                                      
              // 使用刚指定的配置项和数据显示图表。                                                                                                                    
              myChart.setOption(option);                                                                                                              
            }                                                                                                                                         
          } else {                                                                                                                                    
            alert(res.error);                                                                                                                         
          }                                                                                                                                           
        },                                                                                                                                            
      });                                                                                                                                             
    }                                                                                                                                                 
  </script>                                                                                                                                           
                                                                                                                                                      
  <script type="text/javascript">                                                                                                                   
    var del_ID; //全局变量                                                                                                                                
    var edit_ID;                                                                                                                                      
    var day = new Date();                                                                                                                             
    //初始化                                                                                                                                             
    var ops = {                                                                                                                                       
      //日期格式                                                                                                                                          
      todayHighlight: true, //设置当天日期高亮                                                                                                                
      autoclose: true, //选择后自动关闭                                                                                                                      
      clearBtn: true, //清除按钮                                                                                                                          
      format: "yyyy-mm-dd", //日期格式                                                                                                                  
      classes: "cs-like",                                                                                                                           
      language: "zh-CN", //语言                                                                                                                       
    };                                                                                                                                                
    $("#id_start_time").datepicker(ops); //为开始日期实现日期控件                                                                                              
    $("#id_finished_time").datepicker(ops); //为结束日期实现日期控件                                                                                           
                                                                                                                                                      
    $(function () {                                                                                                                                   
      bindbtn_addEvent(); //list界面的添加按钮事件                                                                                                             
      bindbtn_editEvent(); //list界面的编辑按钮事件                                                                                                            
      bindbtn_delEvent(); //list界面的删除按钮事件                                                                                                             
      bindbtn_saveEvent(); // 模态框中保存按钮事件                                                                                                              
      bindbtn_confirm_delEvent(); // 模态框中确认删除按钮事件                                                                                                     
    });                                                                                                                                               
                                                                                                                                                      
    function bindbtn_addEvent() {                                                                                                                     
      //点击按钮显示模态对话框                                                                                                                                   
      $("#btn_add").click(function () {                                                                                                             
        edit_ID = undefined;                                                                                                                          
        $("#myModalLabel").text("新建");                                                                                                            
        $("#formajax")[0].reset(); //清空form内容                                                                                                       
        $(".error-msg").empty();                                                                                                                    
        //#意味着使用的是id=""这个餐宿                                                                                                                           
        $("#myModal").modal("show");                                                                                                              
      });                                                                                                                                             
    }                                                                                                                                                 
                                                                                                                                                      
    function bindbtn_editEvent() {                                                                                                                    
      //调用的是edit按钮的class中的属性, 使用的是.                                                                                                                   
      $(".btn_edit").click(function () {                                                                                                            
        $("#formajax")[0].reset(); //清空form内容                                                                                                       
        $(".error-msg").empty();                                                                                                                    
        var uid = $(this).attr("uid");                                                                                                              
        edit_ID = uid;                                                                                                                                
        $("#myModalLabel").text("编辑"); //修改标题                                                                                                     
                                                                                                                                                      
        $.ajax({                                                                                                                                      
          url: "/order/" + uid + "/detail/",                                                                                                      
          type: "GET", //大括号内的是字典, 使用:                                                                                                              
          data: $("#formajax").serialize(), //直接获取form3中所有含name属性 框内的值                                                                              
          dataType: "JSON",                                                                                                                         
          success: function (res) {                                                                                                                   
            if (res.status) {                                                                                                                         
              //把数据赋值到即将打开的页面中                                                                                                                        
              $.each(res.data, function (name, value) {                                                                                               
                $("#id_" + name).val(value); //给编辑界面填充数据                                                                                            
              });                                                                                                                                     
                                                                                                                                                      
              $("#myModal").modal("show"); //显示模态框                                                                                                
                                                                                                                                                      
              //location.reload();                                                                                                                    
            } else {                                                                                                                                  
              alert(res.error);                                                                                                                       
            }                                                                                                                                         
          },                                                                                                                                          
        });                                                                                                                                           
      });                                                                                                                                             
    }                                                                                                                                                 
                                                                                                                                                      
    function bindbtn_delEvent() {                                                                                                                     
      //调用的是del按钮的class中的属性, 使用的是.                                                                                                                    
      $(".btn_del").click(function () {                                                                                                             
        //显示删除对话框                                                                                                                                     
        $("#del_modal").modal("show");                                                                                                            
                                                                                                                                                      
        //获取当前行的ID, 并给全局变量 del_ID                                                                                                                     
        del_ID = $(this).attr("uid");                                                                                                               
      });                                                                                                                                             
    }                                                                                                                                                 
                                                                                                                                                      
    function bindbtn_confirm_delEvent() {                                                                                                             
      //调用的是del按钮的id中的属性, 使用的是#                                                                                                                       
      $("#btn_confirm_del").click(function () {                                                                                                     
        $.ajax({                                                                                                                                      
          url: "/order/" + del_ID + "/del/",                                                                                                      
          type: "GET", //大括号内的是字典, 使用:                                                                                                              
          data: $("#formajax").serialize(), //直接获取form3中所有含name属性 框内的值                                                                              
          dataType: "JSON",                                                                                                                         
          success: function (res) {                                                                                                                   
            if (res.status) {                                                                                                                         
              del_ID = 0; //全局变量重置为0                                                                                                                  
              location.reload();                                                                                                                      
            } else {                                                                                                                                  
              alert(res.error);                                                                                                                       
            }                                                                                                                                         
          },                                                                                                                                          
        });                                                                                                                                           
      });                                                                                                                                             
    }                                                                                                                                                 
                                                                                                                                                      
    function doADD() {                                                                                                                                
      $.ajax({                                                                                                                                        
        url: "/order/add/",                                                                                                                         
        type: "post", //大括号内的是字典, 使用:                                                                                                               
        data: $("#formajax").serialize(), //直接获取form3中所有含name属性 框内的值                                                                                
        dataType: "JSON",                                                                                                                           
        success: function (res) {                                                                                                                     
          if (res.status) {                                                                                                                           
            $("#formajax")[0].reset();                                                                                                              
            location.reload();                                                                                                                        
          } else {                                                                                                                                    
            $.each(res.error, function (name, error_list) {                                                                                           
              $("#id_" + name)                                                                                                                      
                .next()                                                                                                                               
                .text(error_list[0]);                                                                                                                 
            });                                                                                                                                       
          }                                                                                                                                           
        },                                                                                                                                            
      });                                                                                                                                             
    }                                                                                                                                                 
                                                                                                                                                      
    function doEDIT() {                                                                                                                               
      $.ajax({                                                                                                                                        
        url: "/order/" + edit_ID + "/edit/",                                                                                                      
        type: "post", //大括号内的是字典, 使用:                                                                                                               
        data: $("#formajax").serialize(), //直接获取form3中所有含name属性 框内的值                                                                                
        dataType: "JSON",                                                                                                                           
        success: function (res) {                                                                                                                     
          if (res.status) {                                                                                                                           
            $("#formajax")[0].reset();                                                                                                              
            location.reload();                                                                                                                        
          } else {                                                                                                                                    
            if (res.not_exist_error) {                                                                                                                
              alert(res.not_exist_error);                                                                                                             
            } else {                                                                                                                                  
              $.each(res.error, function (name, error_list) {                                                                                         
                $("#id_" + name)                                                                                                                    
                  .next()                                                                                                                             
                  .text(error_list[0]);                                                                                                               
              });                                                                                                                                     
            }                                                                                                                                         
          }                                                                                                                                           
        },                                                                                                                                            
      });                                                                                                                                             
    }                                                                                                                                                 
                                                                                                                                                      
    function bindbtn_saveEvent() {                                                                                                                    
      $("#btn_save").click(function () {                                                                                                            
        //按钮的click事件                                                                                                                                  
        //#意味着使用的是id=""这个餐宿                                                                                                                           
        $(".error-msg").empty(); //这里必须用class的属性来设置,才能成功                                                                                            
        if (edit_ID) {                                                                                                                                
          //编辑                                                                                                                                        
          doEDIT();                                                                                                                                   
        } else {                                                                                                                                      
          //添加                                                                                                                                        
          doADD();                                                                                                                                    
        }                                                                                                                                             
      });                                                                                                                                             
    }                                                                                                                                                 
  </script>                                                                                                                                           
                                                                                                                                                      
  {% endblock %}                                                                                                                                      
</div>                                                                                                                                                
                                                                                                                                                      
